{% extends "../../partials/layout.njk" %}

{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}

{% set pageTitle = applicationName + " - calculation summary" %}
{% set pageId = "view-calculation-summary" %}

{% block aside %}
    {% if model.prisonerDetail %}
        {% set prisonerDetail = model.prisonerDetail %}
        {% include "../partials/prisonerIdentityBar.njk" %}
    {% endif %}
{% endblock %}

{% block beforeContent %}
    {{super()}}

    {% if model.calculationSummaryUnavailable %}
        {% if model.dpsEntryPoint %}
            {% set backlink = "/?prisonId=" + model.prisonerDetail.offenderNo %}
        {% else %}
            {% set backlink = "/view/search/prisoners" %}
        {% endif %}
        <nav>
            {{ govukBackLink({
                text: "Back",
                href: backlink
            }) }}
        </nav>
    {% endif %}
{% endblock %}

{% block content %}
    {% set validationErrors = model.validationErrors %}
    {% include "../partials/customErrorBanner.njk" %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <h1 class="govuk-heading-xl">Release dates {% if model.prisonerDetail %} for {{ model.prisonerDetail.firstName | title + ' ' + model.prisonerDetail.lastName | title }}
                {% endif %}
            </h1>
            <p class="govuk-body govuk-!-margin-top-8">
                <a href={{"/view/" + model.nomsId + "/calculation-summary/" + model.calculationRequestId + "/print"}}>Print calculation summary</a>
            </p>
            <p class="govuk-body">
                <a class="govuk-link" href="/view/search/prisoners">View previous calculation for another person</a>
            </p>
            <p class="govuk-body govuk-!-margin-bottom-0">
                <a class="govuk-link" href={{model.digitalPrisonServicesUrl}}>Back to Digital Prison Service (DPS) search</a>
            </p>

            <h2 class="govuk-heading-l govuk-!-margin-top-9">Final release dates with adjustments</h2>
        </div>
    </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-half">
            {% include "../partials/calculationSummaryDates.njk" %}
        </div>
    </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            {% include "../partials/calculationSummary/detailsMissingInset.njk" %}
            {% include "../partials/calculationSummary/howDatesCalculatedInset.njk" %}
        </div>
    </div>

    {% include "../partials/calculationSummaryBreakdown.njk" %}

    {% if not model.calculationSummaryUnavailable %}
        <div class="govuk-grid-row">
            <nav class="pagination" role="navigation" aria-label="Pagination">
                <ul class="pagination__list">
                    <li class="pagination__item pagination__item--previous">
                        <a href={{"/view/" + nomsId + "/sentences-and-offences/" + model.calculationRequestId}} class="govuk-link pagination__link" data-qa="previous-page-button">
                            <span class="pagination__link-title">
                                <svg class="gem-c-pagination__link-icon" xmlns="http://www.w3.org/2000/svg" height="13" width="17" viewBox="0 0 17 13">
                                    <path d="m6.5938-0.0078125-6.7266 6.7266 6.7441 6.4062 1.377-1.449-4.1856-3.9768h12.896v-2h-12.984l4.2931-4.293-1.414-1.414z"></path>
                                </svg>
                                <span class="pagination__link-text">Previous page</span>
                            </span>
                            <span class="pagination__link-divider visually-hidden">:</span>
                            <span class="pagination__link-label">Release dates</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    {% endif %}
{% endblock %}