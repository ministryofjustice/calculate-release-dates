name: rename-project-create-pr

on:
  workflow_dispatch:
    inputs:
      slack_releases_channel:
        description: 'Slack channel for release notifications.'
        required: true
        default: ''
      pipeline_security_slack_channel:
        description: 'Slack channel for pipeline security notifications.'
        required: true
        default: ''
      non_prod_alerts_prometheus_severity_label:
        description: 'Non-prod k8s alerts. The severity label used by prometheus to route alert notifications to slack. See cloud-platform user guide.'
        required: true
        default: 'digital-prison-service-dev'
      prod_alerts_prometheus_severity_label:
        description: 'Production k8s alerts. The severity label used by prometheus to route alert notifications to slack. See cloud-platform user guide.'
        required: true
        default: 'digital-prison-service'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run rename-project script
        run: ./rename-project.bash ${{ github.event.repository.name }} ${{ github.event.input.slack_releases_channel }} ${{ github.event.input.pipeline_security_slack_channel }} ${{ github.event.input.non_prod_alerts_prometheus_severity_label }} ${{ github.event.input.prod_alerts_prometheus_severity_label }}

      - name: Delete this github actions workflow
        run: rm .github/workflows/rename_template_project*

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: updating project name after deployment from template repository
          title: Update template project name/references
          body: Update all references to project name after deploying from template repository
          branch: rename_template_project
          base: main
